import os
from requests import Request, Session
from requests.exceptions import ConnectionError, Timeout, TooManyRedirects
import json

# API Key that is hidden for security purposes
my_secret = os.environ['secret_code']

# Coin Market Cap website the program is accessing for information consumption
url = 'https://pro-api.coinmarketcap.com/v1/cryptocurrency/quotes/latest'

# Dictionary that accesses the cryptos by number, or the first one. In this case, the number one coin is Bitcoin
parameters = {
  'id': '1'
}

# API Key dictionary using JSON headers
headers = {
  'Accepts': 'application/json',
  'X-CMC_PRO_API_KEY': my_secret
}

# Current session with API Keys to retrieve existing session data
session = Session()
session.headers.update(headers)

# Empty string to add coin name and price to
coin_price = ''

# Test that attempts to retrieve the coin name and current price in USD, otherwise throws an error
try:
  response = session.get(url, params=parameters)
  data = json.loads(response.text)
  coin_price += str(data['data']['1']['name']) + ' $'
  coin_price += str(data['data']['1']['quote']['USD']['price'])
  coin_price += '\n___________________________'
except (ConnectionError, Timeout, TooManyRedirects) as e:
  print(e)

# When called prints the name of coin at the '1' position and it's current USD price, which is updated every 60 seconds.
print(coin_price)


